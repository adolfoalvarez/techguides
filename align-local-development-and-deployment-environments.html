<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.2 Align local development and deployment environments | Technical Guidelines</title>
  <meta name="description" content="2.2 Align local development and deployment environments | Technical Guidelines" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="2.2 Align local development and deployment environments | Technical Guidelines" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.2 Align local development and deployment environments | Technical Guidelines" />
  
  
  

<meta name="author" content="Mirai Solutions" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="version-stable-deployments.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="roxygen-documentation-guidelines.html"><a href="roxygen-documentation-guidelines.html"><i class="fa fa-check"></i><b>1</b> Roxygen documentation guidelines</a><ul>
<li class="chapter" data-level="1.1" data-path="general-guidelines-and-documentation-workflow.html"><a href="general-guidelines-and-documentation-workflow.html"><i class="fa fa-check"></i><b>1.1</b> General guidelines and documentation workflow</a></li>
<li class="chapter" data-level="1.2" data-path="content-organization.html"><a href="content-organization.html"><i class="fa fa-check"></i><b>1.2</b> Content organization</a><ul>
<li class="chapter" data-level="1.2.1" data-path="content-organization.html"><a href="content-organization.html#note-about-title"><i class="fa fa-check"></i><b>1.2.1</b> Note about <code>@title</code></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="advanced-usage-and-consistent-documentation.html"><a href="advanced-usage-and-consistent-documentation.html"><i class="fa fa-check"></i><b>1.3</b> Advanced usage and consistent documentation</a><ul>
<li class="chapter" data-level="1.3.1" data-path="advanced-usage-and-consistent-documentation.html"><a href="advanced-usage-and-consistent-documentation.html#roxygen-templates-and-example-scripts"><i class="fa fa-check"></i><b>1.3.1</b> Roxygen templates and example scripts</a></li>
<li class="chapter" data-level="1.3.2" data-path="advanced-usage-and-consistent-documentation.html"><a href="advanced-usage-and-consistent-documentation.html#using-rdname-and-describein"><i class="fa fa-check"></i><b>1.3.2</b> Using <code>@rdname</code> and <code>@describeIn</code></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>1.4</b> Examples</a><ul>
<li class="chapter" data-level="1.4.1" data-path="examples.html"><a href="examples.html#general-content-organization"><i class="fa fa-check"></i><b>1.4.1</b> General content organization</a></li>
<li class="chapter" data-level="1.4.2" data-path="examples.html"><a href="examples.html#templates-and-example-scripts"><i class="fa fa-check"></i><b>1.4.2</b> Templates and example scripts</a></li>
<li class="chapter" data-level="1.4.3" data-path="examples.html"><a href="examples.html#rdname"><i class="fa fa-check"></i><b>1.4.3</b> <code>@rdname</code></a></li>
<li class="chapter" data-level="1.4.4" data-path="examples.html"><a href="examples.html#describein"><i class="fa fa-check"></i><b>1.4.4</b> <code>@describeIn</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="version-stable-r-development-with-docker.html"><a href="version-stable-r-development-with-docker.html"><i class="fa fa-check"></i><b>2</b> Version-stable R development with Docker</a><ul>
<li class="chapter" data-level="2.1" data-path="version-stable-deployments.html"><a href="version-stable-deployments.html"><i class="fa fa-check"></i><b>2.1</b> Version-stable deployments</a></li>
<li class="chapter" data-level="2.2" data-path="align-local-development-and-deployment-environments.html"><a href="align-local-development-and-deployment-environments.html"><i class="fa fa-check"></i><b>2.2</b> Align local development and deployment environments</a><ul>
<li class="chapter" data-level="2.2.1" data-path="align-local-development-and-deployment-environments.html"><a href="align-local-development-and-deployment-environments.html#running-versioned-rstudio-instances"><i class="fa fa-check"></i><b>2.2.1</b> Running versioned RStudio instances</a></li>
<li class="chapter" data-level="2.2.2" data-path="align-local-development-and-deployment-environments.html"><a href="align-local-development-and-deployment-environments.html#tinytex-considerations"><i class="fa fa-check"></i><b>2.2.2</b> TinyTeX considerations</a></li>
<li class="chapter" data-level="2.2.3" data-path="align-local-development-and-deployment-environments.html"><a href="align-local-development-and-deployment-environments.html#cleanup"><i class="fa fa-check"></i><b>2.2.3</b> Cleanup</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>2.3</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cicd-pypelines-for-automatic-deployment-of-a-r-shiny-web-app.html"><a href="cicd-pypelines-for-automatic-deployment-of-a-r-shiny-web-app.html"><i class="fa fa-check"></i><b>3</b> CI/CD pypelines for automatic deployment of a R Shiny web app</a><ul>
<li class="chapter" data-level="3.1" data-path="generic-cicd-pipeline.html"><a href="generic-cicd-pipeline.html"><i class="fa fa-check"></i><b>3.1</b> Generic CI/CD pipeline</a></li>
<li class="chapter" data-level="3.2" data-path="travis-ci.html"><a href="travis-ci.html"><i class="fa fa-check"></i><b>3.2</b> Travis CI</a><ul>
<li class="chapter" data-level="3.2.1" data-path="travis-ci.html"><a href="travis-ci.html#standard-ci-setup"><i class="fa fa-check"></i><b>3.2.1</b> Standard CI setup</a></li>
<li class="chapter" data-level="3.2.2" data-path="travis-ci.html"><a href="travis-ci.html#using-renv-for-your-project"><i class="fa fa-check"></i><b>3.2.2</b> Using renv for your project</a></li>
<li class="chapter" data-level="3.2.3" data-path="travis-ci.html"><a href="travis-ci.html#automated-deployment"><i class="fa fa-check"></i><b>3.2.3</b> Automated deployment</a></li>
<li class="chapter" data-level="3.2.4" data-path="travis-ci.html"><a href="travis-ci.html#putting-it-all-together"><i class="fa fa-check"></i><b>3.2.4</b> Putting it all together</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="github-actions.html"><a href="github-actions.html"><i class="fa fa-check"></i><b>3.3</b> GitHub Actions</a><ul>
<li class="chapter" data-level="3.3.1" data-path="github-actions.html"><a href="github-actions.html#workflow-steps"><i class="fa fa-check"></i><b>3.3.1</b> Workflow steps</a></li>
<li class="chapter" data-level="3.3.2" data-path="github-actions.html"><a href="github-actions.html#workflow-file"><i class="fa fa-check"></i><b>3.3.2</b> Workflow file</a></li>
<li class="chapter" data-level="3.3.3" data-path="github-actions.html"><a href="github-actions.html#usethisuse_github_action"><i class="fa fa-check"></i><b>3.3.3</b> <code>usethis::use_github_action()</code></a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Technical Guidelines</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="align-local-development-and-deployment-environments" class="section level2">
<h2><span class="header-section-number">2.2</span> Align local development and deployment environments</h2>
<p>When developing and testing an app locally, it is important to ensure the
environment is aligned with the target deployment environment. This might imply
using e.g. multiple R and package versions for the local development of
different applications, which clash with the typical setup (especially on
Linux systems), where only one R version (the latest release) exists.</p>
<p>The idea is then to rely on the same version-stable rocker containers used for
the deployments, using a containerized versioned RStudio instance for the local
development. This is available through Rocker’s <a href="https://www.rocker-project.org/images/#the-versioned-stack">versioned
stack</a>, so we could
use e.g. <code>rocker/rstudio:3.6.1</code>.</p>
<p>Note that the same version-stable instance of RStudio can be used across all
different projects for which such version is relevant. For this reason, a
sensible choice is to rely on <code>rocker/verse</code>, which adds tidyverse and
devtools to the stack, as well as properly setting up R Markdown system
dependencies TinyTeX and <code>pandoc</code>, sparing the effort of the tedious extra
install. See the specific section below about ‘TinyTeX considerations’.</p>
<div id="running-versioned-rstudio-instances" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Running versioned RStudio instances</h3>
<p>Assume we want to run a containerized versioned instance of RStudio for R 3.6.1,
possibly alongside instances for other versions of R.</p>
<p>First of all, we need to get the image from docker-hub</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="ex">docker</span> pull rocker/verse:3.6.1</a></code></pre></div>
<p>We then want to have a running instance on <code>localhost</code> (<code>127.0.0.1</code>), with the
following setup:</p>
<ul>
<li>No authentication required (local setup).</li>
<li>Enable root by setting the environment variable <code>ROOT</code> to <code>TRUE</code>, so that e.g.
<code>sudo apt-get</code> can be used in RStudio.</li>
<li>Use a version-specific port, e.g. <code>3500</code> for R 3.5.0, <code>3610</code> for R 3.6.1 and
so on, so that we can use <code>localhost</code> for concurrent R version instances.</li>
<li>The development code of all relevant projects should live outside the
container and be shared with it (and possibly many of them), e.g. under
<code>~/RStudioProjects</code> on the host machine and <code>/home/rstudio/RStudioProjects</code> in
the container.
<ul>
<li>For this to work w/o <a href="https://github.com/rocker-org/rocker/wiki/Sharing-files-with-host-machine#avoiding-permission-changes-when-sharing-volumes">permission
issues</a>,
the container user (<code>rstudio</code>) must match the UID of the host user (<code>$UID</code>).</li>
</ul></li>
<li>In order for the RStudio setting to persist if the container is recreated
(e.g. after pulling a new <code>rocker</code> image), we also use a shared volume (like
<code>~/.rstudio-docker/3.6.1</code>) for the <code>home/rstudio/.rstudio</code> directory, which is
version-specific in case of multiple R versions</li>
<li>If we want to use Meld via the <a href="https://github.com/miraisolutions/compareWith/">compareWith</a> addins, we need to
<ul>
<li>map the <code>DISPLAY</code> environment variable and volume <code>/tmp/.X11-unix</code></li>
<li>add <code>DISPLAY</code> to <code>Renviron</code></li>
<li>install Meld</li>
<li>install <code>dbus-x11</code></li>
</ul></li>
<li>Use a version-specific name for the container running the RStudio instance,
e.g. <code>rstudio_3.6.1</code>.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="va">R_VER=</span>3.6.1</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="va">SHARED_DIR=</span>RStudioProjects</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="ex">docker</span> run -d --restart=always \</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  -p 127.0.0.1:<span class="va">$(</span><span class="bu">echo</span> <span class="va">$R_VER</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/[.]//g&#39;</span><span class="va">)</span>0:8787 \</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  -e DISABLE_AUTH=true \</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  -e ROOT=TRUE \</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  -e USERID=<span class="va">$UID</span> \</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  -v <span class="va">$HOME</span>/<span class="va">$SHARED_DIR</span>:/home/rstudio/<span class="va">$SHARED_DIR</span> \</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">  -v <span class="va">$HOME</span>/.rstudio-docker/<span class="va">$R_VER</span>:/home/rstudio/.rstudio \</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">  -e DISPLAY=<span class="va">$DISPLAY</span> \</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">  -v /tmp/.X11-unix:/tmp/.X11-unix:ro \</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">  --name rstudio_<span class="va">$R_VER</span> \</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">  rocker/verse:<span class="va">$R_VER</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co"># R and RStudio are not getting the DISPLAY environment variable</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="ex">docker</span> exec rstudio_<span class="va">$R_VER</span> bash -c \</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">  <span class="st">&#39;echo &quot;DISPLAY=${DISPLAY}&quot; &gt;&gt; /usr/local/lib/R/etc/Renviron&#39;</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co"># Install Meld</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="ex">docker</span> exec rstudio_<span class="va">$R_VER</span> bash -c \</a>
<a class="sourceLine" id="cb8-19" data-line-number="19">  <span class="st">&#39;apt-get update &amp;&amp; apt-get install -y --no-install-recommends meld dbus-x11&#39;</span></a></code></pre></div>
<p>The running RStudio can then be accessed by visiting <code>http://localhost:3610/</code>.</p>
<p>You may find convenient to define a shell function as follows</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="fu">run_rstudio_ver()</span> <span class="kw">{</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="bu">local</span> <span class="va">R_VER=${1:?</span><span class="st">&quot;you must supply the R version as first argument&quot;</span><span class="va">}</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="bu">local</span> <span class="va">SHARED_DIR=${2:?</span><span class="st">&quot;you must supply the shared directory as second argument&quot;</span><span class="va">}</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="bu">local</span> <span class="va">RVER_IMAGE=${3:-</span><span class="st">&quot;verse&quot;</span><span class="va">}</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="bu">local</span> <span class="va">BASE_IMAGE=</span>rocker/<span class="va">$RVER_IMAGE</span>:<span class="va">$R_VER</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="bu">local</span> <span class="va">PORT=$(</span><span class="bu">echo</span> <span class="va">$R_VER</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/[.]//g&#39;</span><span class="va">)</span>0</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="bu">local</span> <span class="va">CONTANER_NAME=</span>rstudio_<span class="va">$R_VER</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  <span class="bu">echo</span> <span class="st">&quot;Containerized version-stable RStudio for R &quot;</span><span class="va">$R_VER</span>\</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">       <span class="st">&quot;based on image &quot;</span><span class="va">$BASE_IMAGE</span>\</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">       <span class="st">&quot;with shared volume &quot;</span><span class="va">$SHARED_DIR</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">  <span class="ex">docker</span> pull <span class="va">$BASE_IMAGE</span> <span class="kw">&amp;&amp;</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">  <span class="ex">docker</span> run -d --restart=always \</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">    -p 127.0.0.1:<span class="va">$PORT</span>:8787 \</a>
<a class="sourceLine" id="cb9-14" data-line-number="14">    -e DISABLE_AUTH=true \</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">    -e ROOT=TRUE \</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">    -e USERID=<span class="va">$UID</span> \</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">    -v <span class="va">$HOME</span>/<span class="va">$SHARED_DIR</span>:/home/rstudio/<span class="va">$SHARED_DIR</span> \</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">    -v <span class="va">$HOME</span>/.rstudio-docker/<span class="va">$R_VER</span>:/home/rstudio/.rstudio \</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">    -e DISPLAY=<span class="va">$DISPLAY</span> \</a>
<a class="sourceLine" id="cb9-20" data-line-number="20">    -v /tmp/.X11-unix:/tmp/.X11-unix:ro \</a>
<a class="sourceLine" id="cb9-21" data-line-number="21">    --name <span class="va">$CONTANER_NAME</span> \</a>
<a class="sourceLine" id="cb9-22" data-line-number="22">    <span class="va">$BASE_IMAGE</span> <span class="kw">&amp;&amp;</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23">  <span class="co"># R and RStudio are not getting the DISPLAY environment variable</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24">  <span class="ex">docker</span> exec <span class="va">$CONTANER_NAME</span> bash -c \</a>
<a class="sourceLine" id="cb9-25" data-line-number="25">    <span class="st">&#39;echo &quot;DISPLAY=${DISPLAY}&quot; &gt;&gt; /usr/local/lib/R/etc/Renviron&#39;</span> <span class="kw">&amp;&amp;</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26">  <span class="co"># Install Meld</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27">  <span class="ex">docker</span> exec <span class="va">$CONTANER_NAME</span> bash -c \</a>
<a class="sourceLine" id="cb9-28" data-line-number="28">    <span class="st">&#39;apt-get update &amp;&amp; apt-get install -y --no-install-recommends meld dbus-x11&#39;</span> <span class="kw">&amp;&amp;</span></a>
<a class="sourceLine" id="cb9-29" data-line-number="29">  <span class="bu">echo</span> <span class="st">&quot;RStudio running in container &quot;</span><span class="va">$CONTANER_NAME</span><span class="st">&quot; on port &quot;</span><span class="va">$PORT</span> <span class="kw">&amp;&amp;</span></a>
<a class="sourceLine" id="cb9-30" data-line-number="30">  <span class="bu">echo</span> <span class="st">&quot;visit http://localhost:&quot;</span><span class="va">$PORT</span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31"><span class="kw">}</span></a></code></pre></div>
<p>which you can re-use as compact command for any R version as follows</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="ex">run_rstudio_ver</span> 3.6.1 RStudioProjects</a></code></pre></div>
<p>Note that <code>--restart=always</code> specifies that the container should stay up and restart
itself after stopping, e.g. upon machine reboot or docker upgrade, so that it is
always available. Still, you can explicitly stop the running container with</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="ex">docker</span> stop rstudio_3.6.1</a></code></pre></div>
<p>Alternatively, you can omit <code>--restart=always</code> and explicitly start the
container whenever needed with</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="ex">docker</span> start rstudio_3.6.1</a></code></pre></div>
<p>Note that <code>start</code>/<code>stop</code> operations do not affect the persistence of files
created outside the shared location, including global RStudio options such as
dark theme, diagnostic, etc. (set via <em>Tools &gt; Global Options…</em>). On the other
hand, these files and settings do <del>not</del> (see above) persist removing the
container (<code>docker rm</code>, see below) .</p>
</div>
<div id="tinytex-considerations" class="section level3">
<h3><span class="header-section-number">2.2.2</span> TinyTeX considerations</h3>
<div id="pdfcrop" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> <code>pdfcrop</code></h4>
<p>Older <code>rocker/verse</code> images might not include <code>pdfcrop</code>, which is required for
the default and desirable cropping of PDF figures with R Markdown (see
<a href="https://github.com/rocker-org/rocker-versioned/issues/146">rocker-org/rocker-versioned#146</a>).
Make sure <code>pdfcrop</code> is installed by running at R console</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">tinytex<span class="op">::</span><span class="kw">tlmgr_install</span>(<span class="st">&quot;pdfcrop&quot;</span>)</a></code></pre></div>
<p>(see <a href="https://bookdown.org/yihui/rmarkdown/pdf-document.html#figure-options-1">R Markdown: The Definitive
Guide</a>)</p>
</div>
<div id="align-tinytex-to-current-remote-repo" class="section level4">
<h4><span class="header-section-number">2.2.2.2</span> Align TinyTeX to current remote repo</h4>
<p><strong>NOTE</strong> - This should never be needed with recent <code>rocker/verse</code> images, where
a version-stable Tex Live repository is used for the TinyTeX install (see
<a href="https://github.com/rocker-org/rocker-versioned/issues/169">rocker-org/rocker-versioned#169</a>).</p>
<p>If you are using LaTeX and start seeing errors like</p>
<pre><code>Remote repository is newer than local (2018 &lt; 2019)</code></pre>
<p>it means that you have to re-install TinyTeX. This happens e.g. with
<code>rocker/verse:3.6.1</code>, since it was build at the end of 2018 but the current
Tex Live repo is 2019. You can fix this via a <strong>user-specific</strong> re-installation of
TinyTeX for R. <strong>NOTE</strong> however that this will uninstall the system-level
TinyTeX pre-installed in <code>rocker/verse</code>.</p>
<p>First, make sure <code>/home/rstudio/bin</code> is part of the <code>PATH</code> environment variable.
Check this by running</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="ex">docker</span> exec --user rstudio rstudio_3.6.1 R --slave -e <span class="st">&#39;Sys.getenv(&quot;PATH&quot;)&#39;</span></a></code></pre></div>
<p>If you don’t see <code>/home/rstudio/bin</code>, you can make sure it is part of the <code>PATH</code> for R via</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="ex">docker</span> exec --user rstudio rstudio_3.6.1 sh -c <span class="st">&#39;echo &quot;PATH=$HOME/bin:\${PATH}&quot; &gt;&gt; $HOME/.Renviron&#39;</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co"># check again</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="ex">docker</span> exec --user rstudio rstudio_3.6.1 R --slave -e <span class="st">&#39;Sys.getenv(&quot;PATH&quot;)&#39;</span></a></code></pre></div>
<p>Then, from the running RStudio, run</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">tinytex<span class="op">::</span><span class="kw">reinstall_tinytex</span>()</a></code></pre></div>
</div>
</div>
<div id="cleanup" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Cleanup</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="ex">docker</span> rm <span class="va">$(</span><span class="ex">docker</span> stop rstudio_3.6.1<span class="va">)</span></a></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="version-stable-deployments.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
